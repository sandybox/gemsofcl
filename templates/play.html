{% extends "./base.html" %}

{% load layout %}

{% block title %}Gems of Craigslist - Spot a Gem!{% endblock %}

{% block head %}
<meta name="description" content="Discover the gems of cragislist.">
{% endblock %}

{% block active_play %}active{% endblock %}

{% block body %}

{% if item %}
<div class="row-fluid">
  <div class="span3">
  <p><a class="btn btn-large btn-success vote-gem" data-id="{{ item.id }}" href="#">Gem</a>
    <a class="btn btn-large btn-success vote-dud" data-id="{{ item.id }}" href="#">Dud</a></p>
  </div>
  <div class="span9">
    <p>
    {% if request.session.countdown > 5 %}{{ request.session.countdown }} more to go!
    {% elif request.session.countdown > 3 %}Only {{ request.session.countdown }} more!
    {% elif request.session.countdown > 0 %}{{ request.session.countdown }} left, so close!
    {% elif request.session.countdown < 1 %}You have earned the right to see the <a href="{% url displaygems %}">gems</a>. But feel free keep playing!
    {% endif %}
    </p>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h4>{{ item.title|trimtitle|safe }}&nbsp;&nbsp;<a href="{{ item.url }}"><img src="{{ STATIC_URL }}img/external_link.png" /></a></h4>
    <div class="imageholder">
      <img src="{{ item.first_image.url }}" />
      <strong class="PriceContainer">
        <strong class="price">${{ item.price }}</strong>
      </strong>
    </div>
  </div>
  <div style="display:none">
    <form id="vote-form" method="POST" action="{% url play %}">{% csrf_token %}
      <input type="hidden" id="form-item-id" name="item_id" value="{{ item.id }}" />
      <input type="hidden" id="form-action" name="action" value="" />
      <input type="submit" value="Submit" />
    </form>
  </div>
</div>
{% endif %}

<hr>

{% endblock %}

{% block body_bottom %}
<script type="text/javascript">
$(document).ready( function() {
  $('.vote-gem').click(function() {
    var item_id = $(this).attr('data-id');
    console.log('Gem ' + item_id);
    $('#form-action').attr('value', 'gem');
    $('#vote-form').submit();
  });

  $('.vote-dud').click(function() {
    var item_id = $(this).attr('data-id');
    console.log('Dud ' + item_id);
    $('#form-action').attr('value', 'dud');
    $('#vote-form').submit();
  });
});
</script>
{% endblock %}